@model IEnumerable<Recipes.Models.Recipe>

@{
    ViewBag.Title = "Recipes";
    Recipes.Models.Client clnt = (Recipes.Models.Client)Session["Client"];
}

@using (Html.BeginForm("Search", "Recipes", FormMethod.Get))
{
    <h6 style="margin: 20px 0">Enter up to 3 search parameters and click the "Search" button below</h6>

    <div class="row">
        <div class="form-group">
            <div class="col-md-2">
                Title:
            </div>
            <div class="col-md-10">
                <input type="text" name="title" />
            </div>
        </div>
    </div>
    <div class="row">
        <div class="form-group">
            <div class="col-md-2">
                Content:
            </div>
            <div class="col-md-10">
                <input type="text" name="content" />
            </div>
        </div>
    </div>
    <div class="row">
        <div class="form-group">
            <div class="col-md-2">
                Date:
            </div>
            <div class="col-md-10">
                <input type="date" name="date" />
            </div>
        </div>
    </div>
    <div class="row">
        <div class="form-group">
            <div class="col-md-10">
                <input type="submit" value="Search" class="btn btn-default" />
            </div>
        </div>
    </div>

    <hr />

    <div class="col-md-10">
        @if (clnt != null)
        {
            <h6>Can't find the right recipe?</h6>
            <button type="button" class="btn">
                @Html.ActionLink("Add a new Recipe", "Create")
            </button>
        }
    </div>

    <hr />
}

@foreach (var recipe in Model)
{
    <section>
        <article class="blogPost">
            <h4 style="color: green">
                @Html.DisplayFor(modelItem => recipe.Title)
            </h4>
            
            <p>Posted on @Html.DisplayFor(modelItem => recipe.CreationDate) by <a href="#">@Html.DisplayFor(modelItem => recipe.Client.ClientName)</a> - <a href="#comments">@recipe.Comments.Count Comments</a> in @Html.DisplayFor(modelItem => recipe.Category.Name) category</p>

            @Html.DisplayFor(modelItem => recipe.Content)

            @if (clnt != null && clnt.IsAdmin)
                {
                <div>
                    @Html.ActionLink("Edit", "Edit", new { id = recipe.Id }) |
                    @Html.ActionLink("Details", "Details", new { id = recipe.Id }) |
                    @Html.ActionLink("Delete", "Delete", new { id = recipe.Id })
                </div>
            }
        </article>
    </section>
        <br />
        <section id="comments">
            <h5>Comments</h5>
            @foreach (var comment in recipe.Comments)
            {
                <article>
                    <header>
                        <span>By @comment.Client.ClientName</span> at @comment.CreationDate
                    </header>
                    @comment.Content
                </article>
            }

            @if (clnt != null)
            {
                using (Html.BeginForm("PostComment", "Recipes"))
                {

                    <input type="hidden" name="clientId" value="@clnt.Id" />
                    <input type="hidden" name="recipeId" value="@recipe.Id" />

                    <input type="text" name="content" placeholder="Add a new comment..." style="margin: 10px 0" />

                    <input type="submit" value="Post" class="btn btn-default" />

                    <br />
                }
            }
        </section>
        <hr />
}

