@model IEnumerable<Recipes.ViewModels.UserRecipesViewModel>
    @{
        Layout = "~/Views/Shared/_Layout.cshtml";
    }

    <h2>Statistics of the users</h2>
    @{

        // collections of users
        var usersInfo = Model.Select(x => new
        {
            UserName = x.UserName,
            FirstName = x.FirstName,
            LastName = x.LastName,
            ID = x.ID
        }).Distinct();

        // collection of users and there comments
        var usersRecipesInfo = usersInfo.Select(user => new
        {
            UserID = user.ID,
            UserName =  user.UserName,
            FirstName = user.FirstName,
            LastName = user.LastName,
            Recipes = Model.Where(y => y.ID == user.ID).ToArray()
        });

        // collection of users and number of recipes (for JSON phi data)
        var usersReplayCount = usersRecipesInfo.Select(x => new { Name = x.UserName, Count = x.Recipes.Count() });
        
        }

    <h2 class="page-title">@ViewBag.Title</h2>
    <p>The most popular reviewers by how much they write recipes.</p>

    <table class="table">
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.UserName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.FirstName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.LastName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Title)
            </th>
        </tr>

        @{
            foreach (var user in usersRecipesInfo)
            {
                <tr>
                    <td>
                        @user.UserName
                    </td>
                    <td>
                        @user.FirstName
                    </td>
                    <td>
                        @user.LastName
                    </td>
                    <td>
                        <ul>
                            @{
                                // print recipes for each user
                                foreach (var recipe in user.Recipes)
                                {
                                    <li>
                                        @recipe.Title 
                                        @Html.ActionLink(recipe.Title, "../Recipes/DetailsByTitle", new { title = recipe.Title})
                                    </li>
                                }
                            }
                        </ul>
                    </td>
                </tr>
                                }
        }

    </table>

    <section id="popular-clients-graph">
        <h3>Pie Chart</h3>
    </section>

    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="~/Scripts/graph.js"></script>
    <script>
        // print JSON data
        var usersData = @Html.Raw(Json.Encode(usersReplayCount));
        createPopularUsersGraph(usersData, "popular-clients-graph");
    </script>

<section>
    <h3>Pie Chart</h3>
    <div id="popular-gender-graph"></div>
</section>
<script>
        // print JSON data
        $.ajax({
            url: '/Clients/GetGroupByGender',
            success: function(data) {
                createPopularUsersGraph(data, "popular-gender-graph");        
            }
        })
</script>